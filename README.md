
# analysis of [Rhee and Pugh, 2012](https://doi.org/10.1038/nature10799)

## description

Code used to align ChIP-exo data from [Rhee and Pugh, 2012](https://doi.org/10.1038/nature10799) and compare it to ChIP-nexus data from [our preprint](https://doi.org/10.1101/347575). To reproduce the results from our paper, use the archived version of this analysis from [Zenodo](https://doi.org/10.5281/zenodo.1325930).

## requirements

### required software

- Unix-like operating system (tested on CentOS 7.2.1511)
- Git
- [conda](https://conda.io/docs/user-guide/install/index.html)

### required files

Again, to reproduce the results from our paper, use the archived version of this analysis from [Zenodo](https://doi.org/10.5281/zenodo.1325930).

- FASTA file of the *S. cerevisiae* genome, [available here](https://github.com/winston-lab/genomefiles-cerevisiae).
    - in the Zenodo archive, this file is in the `genomefiles_cerevisiae` directory
- bedGraph and bigWig files of ChIP-nexus coverage, generated by the [ChIP-nexus pipeline](https://github.com/winston-lab/chip-nexus)
    - in the Zenodo archive, these are the pipelines in the `chipnexus-tfiib-publication` and `chipnexus-spt6-v-rnapii` directories
- [BED6](https://genome.ucsc.edu/FAQ/FAQformat.html#format1) format annotation files of regions to visualize the data over
    - in the Zenodo archive, these files are in the `genomefiles_cerevisiae/annotations` directory

## instructions

**0**. If running the analysis in the Zenodo archive, the pipelines in the `chipnexus-tfiib-publication` and `chipnexus-spt6-v-rnapii` directories need to be run before running this pipeline.

**1**. Create and activate the `rhee12` virtual environment for this pipeline using conda. This can take a while, be patient. 

```bash
# create the rhee12 environment
conda env create -v -f envs/default.yaml

# activate the environment
source activate rhee12

# to deactivate the environment
# source deactivate
```

**2**. The configuration file `config.yaml` is set up to point to ChIP-nexus coverage files generated by the `chipnexus-tfiib-publication` and `chipnexus-spt6-v-rnapii` pipelines in the Zenodo archive. If using other ChIP-nexus coverage files, or if visualizing results over additional regions, the config file should be edited to reflect this.

```bash
# edit the configuration file
vim config.yaml    # or use your favorite editor
```

**3**. With the `rhee12` environment activated, do a dry run of the pipeline to see what files will be created.

```bash
snakemake -p --use-conda --dry-run
```

**4**. If running the pipeline on a local machine, you can run the pipeline using the above command, omitting the `--dry-run` flag. You can also use N cores by specifying the `--cores N` flag. The first time the pipeline is run, conda will create separate virtual environments for some of the jobs to operate in. Running the pipeline on a local machine can take a long time, especially for many samples, so it's recommended to use an HPC cluster if possible. On the HMS O2 cluster, which uses the SLURM job scheduler, entering `sbatch slurm.sh` will submit the pipeline as a single job which spawns individual subjobs as necessary. This can be adapted to other job schedulers and clusters by modifying `slurm.sh` and `cluster.yaml`, which specifies the resource requests for each type of job.

